{"ast":null,"code":"import { apiRequest } from '../actions/apiRequest';\nimport { REGISTER_START, REGISTER_SUCCESS, LOGIN_START, LOGIN_SUCCESS, AUTH_ERROR, ALREDY_LOGGED, LOGOUT, authError, loginSuccess, registerSuccess, loading } from '../actions/auth';\nimport { getUser, clearUser } from '../actions/user';\nimport { clearTeacher } from '../actions/teacher';\nimport { clearProfile } from '../actions/profile';\nimport setAuthToken from '../../utils/setAuthToken';\nconst configJson = {\n  headers: {\n    'Content-Type': 'application/json'\n  }\n};\n\nconst auth = ({\n  dispatch\n}) => next => action => {\n  next(action);\n\n  if (action.type === REGISTER_START) {\n    const {\n      name,\n      email,\n      password,\n      params\n    } = action.payload;\n    let url = '';\n\n    if (params.class) {\n      url = `/api/users/student/${params.teacher}/${params.class}`;\n    } else {\n      url = `/api/users/teacher/${params.teacher}`;\n    }\n\n    dispatch(loading());\n    dispatch(apiRequest('POST', url, registerSuccess, authError, {\n      name,\n      email,\n      password\n    }, configJson));\n  }\n\n  if (action.type === LOGIN_START) {\n    const url = '/api/auth';\n    dispatch(loading());\n    dispatch(apiRequest('POST', url, loginSuccess, authError, action.payload, configJson));\n  }\n\n  if (action.type === REGISTER_SUCCESS || action.type === LOGIN_SUCCESS || action.type === ALREDY_LOGGED) {\n    setAuthToken(action.payload.token);\n    dispatch(getUser());\n  }\n\n  if (action.type === LOGOUT) {\n    dispatch(clearUser());\n    dispatch(clearTeacher());\n    dispatch(clearProfile());\n  }\n};\n\nexport default auth;","map":{"version":3,"sources":["C:/Users/pekus/Desktop/desktop/liveMathDemoRedux/client/src/redux/middleware/auth.js"],"names":["apiRequest","REGISTER_START","REGISTER_SUCCESS","LOGIN_START","LOGIN_SUCCESS","AUTH_ERROR","ALREDY_LOGGED","LOGOUT","authError","loginSuccess","registerSuccess","loading","getUser","clearUser","clearTeacher","clearProfile","setAuthToken","configJson","headers","auth","dispatch","next","action","type","name","email","password","params","payload","url","class","teacher","token"],"mappings":"AAAA,SAASA,UAAT,QAA2B,uBAA3B;AACA,SACEC,cADF,EAEEC,gBAFF,EAGEC,WAHF,EAIEC,aAJF,EAKEC,UALF,EAMEC,aANF,EAOEC,MAPF,EAQEC,SARF,EASEC,YATF,EAUEC,eAVF,EAWEC,OAXF,QAYO,iBAZP;AAcA,SAASC,OAAT,EAAkBC,SAAlB,QAAmC,iBAAnC;AACA,SAASC,YAAT,QAA6B,oBAA7B;AACA,SAASC,YAAT,QAA6B,oBAA7B;AAEA,OAAOC,YAAP,MAAyB,0BAAzB;AAEA,MAAMC,UAAU,GAAG;AACjBC,EAAAA,OAAO,EAAE;AACP,oBAAiB;AADV;AADQ,CAAnB;;AAMA,MAAMC,IAAI,GAAG,CAAC;AAACC,EAAAA;AAAD,CAAD,KAAgBC,IAAI,IAAIC,MAAM,IAAI;AAC7CD,EAAAA,IAAI,CAACC,MAAD,CAAJ;;AACA,MAAKA,MAAM,CAACC,IAAP,KAAgBtB,cAArB,EAAuC;AACrC,UAAM;AAAEuB,MAAAA,IAAF;AAAQC,MAAAA,KAAR;AAAeC,MAAAA,QAAf;AAAyBC,MAAAA;AAAzB,QAAoCL,MAAM,CAACM,OAAjD;AAEA,QAAIC,GAAG,GAAG,EAAV;;AACA,QAAGF,MAAM,CAACG,KAAV,EAAgB;AACbD,MAAAA,GAAG,GAAI,sBAAqBF,MAAM,CAACI,OAAQ,IAAGJ,MAAM,CAACG,KAAM,EAA3D;AACD,KAFF,MAEQ;AACLD,MAAAA,GAAG,GAAI,sBAAqBF,MAAM,CAACI,OAAQ,EAA3C;AACD;;AACFX,IAAAA,QAAQ,CAACT,OAAO,EAAR,CAAR;AACAS,IAAAA,QAAQ,CAACpB,UAAU,CAAC,MAAD,EAAS6B,GAAT,EAAcnB,eAAd,EAA+BF,SAA/B,EAA0C;AAACgB,MAAAA,IAAD;AAAOC,MAAAA,KAAP;AAAcC,MAAAA;AAAd,KAA1C,EAAmET,UAAnE,CAAX,CAAR;AACD;;AAED,MAAKK,MAAM,CAACC,IAAP,KAAgBpB,WAArB,EAAoC;AAClC,UAAM0B,GAAG,GAAG,WAAZ;AACAT,IAAAA,QAAQ,CAACT,OAAO,EAAR,CAAR;AACAS,IAAAA,QAAQ,CAACpB,UAAU,CAAC,MAAD,EAAS6B,GAAT,EAAcpB,YAAd,EAA4BD,SAA5B,EAAuCc,MAAM,CAACM,OAA9C,EAAuDX,UAAvD,CAAX,CAAR;AACD;;AAED,MAAKK,MAAM,CAACC,IAAP,KAAgBrB,gBAAhB,IACAoB,MAAM,CAACC,IAAP,KAAgBnB,aADhB,IAEAkB,MAAM,CAACC,IAAP,KAAgBjB,aAFrB,EAGI;AACFU,IAAAA,YAAY,CAACM,MAAM,CAACM,OAAP,CAAeI,KAAhB,CAAZ;AACAZ,IAAAA,QAAQ,CAACR,OAAO,EAAR,CAAR;AACD;;AAED,MAAIU,MAAM,CAACC,IAAP,KAAgBhB,MAApB,EAA6B;AAC3Ba,IAAAA,QAAQ,CAACP,SAAS,EAAV,CAAR;AACAO,IAAAA,QAAQ,CAACN,YAAY,EAAb,CAAR;AACAM,IAAAA,QAAQ,CAACL,YAAY,EAAb,CAAR;AACD;AACF,CAlCD;;AAoCA,eAAeI,IAAf","sourcesContent":["import { apiRequest } from '../actions/apiRequest';\r\nimport {\r\n  REGISTER_START,\r\n  REGISTER_SUCCESS,\r\n  LOGIN_START,\r\n  LOGIN_SUCCESS,\r\n  AUTH_ERROR,\r\n  ALREDY_LOGGED,\r\n  LOGOUT,\r\n  authError,\r\n  loginSuccess,\r\n  registerSuccess,\r\n  loading\r\n} from '../actions/auth';\r\n\r\nimport { getUser, clearUser } from '../actions/user';\r\nimport { clearTeacher } from '../actions/teacher';\r\nimport { clearProfile } from '../actions/profile';\r\n\r\nimport setAuthToken from '../../utils/setAuthToken';\r\n\r\nconst configJson = {\r\n  headers: {\r\n    'Content-Type' : 'application/json'\r\n  }\r\n};\r\n\r\nconst auth = ({dispatch}) => next => action => {\r\n  next(action);\r\n  if ( action.type === REGISTER_START  ) {\r\n    const { name, email, password, params } = action.payload;\r\n\r\n    let url = '';\r\n    if(params.class){\r\n       url = `/api/users/student/${params.teacher}/${params.class}`\r\n     } else {\r\n       url = `/api/users/teacher/${params.teacher}`\r\n     }\r\n    dispatch(loading());\r\n    dispatch(apiRequest('POST', url, registerSuccess, authError, {name, email, password}, configJson));\r\n  }\r\n\r\n  if ( action.type === LOGIN_START  ) {\r\n    const url = '/api/auth';\r\n    dispatch(loading());\r\n    dispatch(apiRequest('POST', url, loginSuccess, authError, action.payload, configJson));\r\n  }\r\n\r\n  if ( action.type === REGISTER_SUCCESS ||\r\n       action.type === LOGIN_SUCCESS ||\r\n       action.type === ALREDY_LOGGED\r\n    ) {\r\n    setAuthToken(action.payload.token);\r\n    dispatch(getUser());\r\n  }\r\n\r\n  if( action.type === LOGOUT ) {\r\n    dispatch(clearUser());\r\n    dispatch(clearTeacher());\r\n    dispatch(clearProfile());\r\n  }\r\n};\r\n\r\nexport default auth;\r\n"]},"metadata":{},"sourceType":"module"}